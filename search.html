<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ajax demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <div class="container mt-4">
      <h1>Advanced Car Search</h1>

      <!-- keyword search -->
     <div class="mb-3">
        <input type="text" class="form-control" id="searchBox" placeholder="Search by model">
     </div>

     <!-- price range -->
      <div class="mb-3">
        <label class="form-label">Price Range (£)</label>
        <input type="range" class="form-range" min="0" max="100000" id="priceRange" value="50000">
        <p>Max Price: £<span id="priceValue">50000</span></p>
      </div>

      <!-- accordian filters -->
<div class="accordion" id="filters">
  <!-- Accordion Filters -->
<div class="accordion" id="filters">

<!-- Year Filter -->
<div class="accordion-item">
<h2 class="accordion-header">
<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#yearFilter">
Year
</button>
</h2>
<div id="yearFilter" class="accordion-collapse collapse">
<div class="accordion-body">
<input type="checkbox" class="filter-year" value="2024"> 2024<br>
<input type="checkbox" class="filter-year" value="2023"> 2023<br>
<input type="checkbox" class="filter-year" value="2022"> 2022<br>
<input type="checkbox" class="filter-year" value="2021"> 2021<br>
</div>
</div>
</div>

<!-- Condition Filter -->

<div class="accordion-item">
<h2 class="accordion-header">
<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#conditionFilter">
Condition
</button>
</h2>
<div id="conditionFilter" class="accordion-collapse collapse">
<div class="accordion-body">
<input type="checkbox" class="filter-condition" value="New"> New<br>
<input type="checkbox" class="filter-condition" value="Used"> Used<br>
</div>
</div>
</div>

<!-- Transmission Filter -->


<div class="accordion-item">
<h2 class="accordion-header">
<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#transFilter">
Transmission
</button>
</h2>
<div id="transFilter" class="accordion-collapse collapse">
<div class="accordion-body">
<input type="checkbox" class="filter-trans" value="Automatic"> Automatic<br>
<input type="checkbox" class="filter-trans" value="Manual"> Manual<br>
</div>
</div>
</div>

</div>

<!-- Results -->


<div id="results" class="mt-4"></div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

<script>

// Update price text

document.getElementById("priceRange").addEventListener("input", function() {
document.getElementById("priceValue").innerHTML = this.value;
doSearch();
});

// Keyword listener
document.getElementById("searchBox").addEventListener("keyup", doSearch);

// Checkbox listeners
document.querySelectorAll(".filter-year").forEach(cb => cb.addEventListener("change", doSearch));
document.querySelectorAll(".filter-condition").forEach(cb => cb.addEventListener("change", doSearch));
document.querySelectorAll(".filter-trans").forEach(cb => cb.addEventListener("change", doSearch));

function doSearch() {

// Get keyword
let keywords = document.getElementById("searchBox").value;

// Price filter
let maxPrice = document.getElementById("priceRange").value;

// Year filter
let years = [];
document.querySelectorAll(".filter-year:checked").forEach(cb => years.push(cb.value));

// Condition filter
let conditions = [];
document.querySelectorAll(".filter-condition:checked").forEach(cb => conditions.push(cb.value));

// Transmission filter
let transmissions = [];
document.querySelectorAll(".filter-trans:checked").forEach(cb => transmissions.push(cb.value));

// Build query string
let url = "ajax_advanced.php?search=" + keywords +
"&maxPrice=" + maxPrice +
"&years=" + years.join(",") +
"&conditions=" + conditions.join(",") +
"&transmissions=" + transmissions.join(",");

// Fetch results
fetch(url)
.then(res => res.json())
.then(response => {

document.getElementById("results").innerHTML = "";

if(response.length === 0) {
document.getElementById("results").innerHTML = "<p>No cars found</p>";
return;
}

response.forEach(car => {
document.getElementById("results").innerHTML += 
`<a href="game-details.php?id=${car.car_id}" style="text-decoration:none; color:inherit;">
<div class="card mb-2">
<div class="card-body">
<h5 class="card-title">${car.car_model}</h5>
<p class="card-text">${car.car_registration}</p>
<p class="text-muted">Year: ${car.car_year} | £${car.price}</p>
</div>
</div>
</a>`;
});

});

}

</script>

  </body>
</html>

