<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ajax Dropdown – Cars</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
  <div class="container">

    <h1>Ajax and Bootstrap Dropdown – Cars</h1>

    <div class="dropdown" id="myDropdown">
      <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        Load Cars
      </button>
      <ul class="dropdown-menu" id="myList"></ul>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

  <script>

    const myDropdown = document.getElementById('myDropdown')

    myDropdown.addEventListener('show.bs.dropdown', event => {

      const myList = document.getElementById('myList')

      // Display spinner in dropdown
      myList.innerHTML = '<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>';

      // Call server script
      fetch('https://mi-linux.wlv.ac.uk/~2441631/sem-2/week3/ajax.php')

        // Convert response string to json object
        .then(response => response.json())
        .then(response => {

          // Clear result list
          myList.innerHTML = '';

          // Loop through data and add to result list
          response.forEach(car => {

            // Create list item and add data
            var li = document.createElement("li");
            var a = document.createElement("a");

            a.innerHTML = car.car_model;
            a.href = '#';
            a.classList.add("dropdown-item");

            li.appendChild(a);
            myList.appendChild(li);

          });
        });
    })

  </script>

</body>
</html>
